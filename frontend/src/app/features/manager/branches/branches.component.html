<div class="branches-container">
  <nav class="navbar">
    <div class="nav-content">
      <app-logo></app-logo>
      <div class="nav-actions">
        <span class="user-name">{{ authService.currentUser()?.name }}</span>
        <button class="btn btn-secondary" (click)="authService.logout()">Logout</button>
      </div>
    </div>
  </nav>

  <div class="dashboard-content">
        <aside class="sidebar">
          <ul class="nav-menu">
            <li><a routerLink="/manager" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">Dashboard</a></li>
            <li><a routerLink="/manager/players" routerLinkActive="active">Players</a></li>
            <li><a routerLink="/manager/sessions" routerLinkActive="active">Sessions</a></li>
            <li><a routerLink="/manager/attendance-calendar" routerLinkActive="active">Attendance</a></li>
            <li><a routerLink="/manager/coaches" routerLinkActive="active">Coaches</a></li>
            <li><a routerLink="/manager/fees" routerLinkActive="active">Fees</a></li>
            <li><a routerLink="/manager/branches" routerLinkActive="active">Branches</a></li>
            <li><a routerLink="/manager/monthly-records" routerLinkActive="active">Monthly Records</a></li>
            <li><a routerLink="/manager/revenue" routerLinkActive="active">Revenue</a></li>
            <li><a routerLink="/manager/settings" routerLinkActive="active">Settings</a></li>
          </ul>
        </aside>

    <main class="main-content fade-in">
      <div class="header-actions">
        <h1>Branches Management</h1>
        <button class="btn btn-primary" (click)="openAddModal()">+ Add Branch</button>
      </div>

      <div *ngIf="loading()" class="loading">
        <div class="spinner"></div>
      </div>

      <div *ngIf="!loading() && branches().length > 0" class="branches-grid">
        <div *ngFor="let branch of branches(); let i = index" class="branch-card slide-in" [style.animation-delay]="i * 0.1 + 's'">
          <div class="branch-header">
            <h3>{{ branch.name }}</h3>
          </div>
          <div class="branch-content">
            <div class="branch-details">
              <div class="detail-item">
                <span class="icon">üìç</span>
                <span>{{ branch.address }}</span>
              </div>
              <div class="detail-item">
                <span class="icon">üìû</span>
                <span>{{ branch.phone }}</span>
              </div>
              <div class="detail-item" *ngIf="branch.email">
                <span class="icon">‚úâÔ∏è</span>
                <span>{{ branch.email }}</span>
              </div>
              <div class="detail-item" *ngIf="branch.manager_name">
                <span class="icon">üë§</span>
                <span>Manager: {{ branch.manager_name }}</span>
              </div>
              <div class="detail-item">
                <span class="icon">üë•</span>
                <span>Capacity: {{ branch.players_count || 0 }} / {{ branch.capacity }}</span>
              </div>
            </div>
            <div *ngIf="branch.latitude && branch.longitude" class="branch-map-container">
              <app-location-display 
                [latitude]="branch.latitude"
                [longitude]="branch.longitude">
              </app-location-display>
            </div>
          </div>
          <div class="card-actions">
            <button class="btn btn-sm btn-edit" (click)="openEditModal(branch)">Edit</button>
            <button class="btn btn-sm btn-danger" (click)="deleteBranch(branch.id)">Delete</button>
          </div>
        </div>
      </div>

      <div *ngIf="!loading() && branches().length === 0" class="empty-state">
        <p>No branches found.</p>
      </div>
    </main>
  </div>

  <!-- Add Branch Modal -->
  <div *ngIf="showAddModal()" class="modal-overlay" (click)="closeAddModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Add New Branch</h2>
        <button class="modal-close" (click)="closeAddModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="saveBranch()">
          <div class="form-group">
            <label>Branch Name <span class="required">*</span></label>
            <input type="text" [(ngModel)]="newBranch().name" name="name" required>
          </div>
          <div class="form-group">
            <label>Address <span class="required">*</span></label>
            <input type="text" [(ngModel)]="newBranch().address" name="address" required>
          </div>
          <div class="form-group">
            <label>Location</label>
            <app-location-input 
              [latitude]="newBranch().latitude"
              [longitude]="newBranch().longitude"
              (locationSelected)="onLocationSelected($event, false)">
            </app-location-input>
          </div>
          <div class="form-group">
            <label>Phone <span class="required">*</span></label>
            <input type="tel" [(ngModel)]="newBranch().phone" name="phone" required>
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" [(ngModel)]="newBranch().email" name="email">
          </div>
          <div class="form-group">
            <label>Manager Name</label>
            <input type="text" [(ngModel)]="newBranch().manager_name" name="manager_name">
          </div>
          <div class="form-group">
            <label>Capacity <span class="required">*</span></label>
            <input type="number" [(ngModel)]="newBranch().capacity" name="capacity" required min="1">
          </div>
          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" (click)="closeAddModal()">Cancel</button>
            <button type="submit" class="btn btn-primary" [disabled]="saving()">
              {{ saving() ? 'Saving...' : 'Save Branch' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Branch Modal -->
  <div *ngIf="showEditModal()" class="modal-overlay" (click)="closeEditModal()">
    <div class="modal-content" #editModalContent (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Edit Branch</h2>
        <button class="modal-close" (click)="closeEditModal()">&times;</button>
      </div>
      <div class="modal-body" #editModalContent>
        <form (ngSubmit)="updateBranch()">
          <div class="form-group">
            <label>Branch Name <span class="required">*</span></label>
            <input type="text" [(ngModel)]="newBranch().name" name="edit_name" required>
          </div>
          <div class="form-group">
            <label>Address <span class="required">*</span></label>
            <input type="text" [(ngModel)]="newBranch().address" name="edit_address" required>
          </div>
          <div class="form-group">
            <label>Location</label>
            <app-location-input 
              [latitude]="newBranch().latitude"
              [longitude]="newBranch().longitude"
              (locationSelected)="onLocationSelected($event, true)">
            </app-location-input>
          </div>
          <div class="form-group">
            <label>Phone <span class="required">*</span></label>
            <input type="tel" [(ngModel)]="newBranch().phone" name="edit_phone" required>
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" [(ngModel)]="newBranch().email" name="edit_email">
          </div>
          <div class="form-group">
            <label>Manager Name</label>
            <input type="text" [(ngModel)]="newBranch().manager_name" name="edit_manager_name">
          </div>
          <div class="form-group">
            <label>Capacity <span class="required">*</span></label>
            <input type="number" [(ngModel)]="newBranch().capacity" name="edit_capacity" required min="1">
          </div>
          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" (click)="closeEditModal()">Cancel</button>
            <button type="submit" class="btn btn-primary" [disabled]="saving()">
              {{ saving() ? 'Updating...' : 'Update Branch' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
